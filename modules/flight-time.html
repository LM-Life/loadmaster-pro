<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Loadmaster Pro | Flight Time</title>
  <link rel="stylesheet" href="../style.css">
  
  <style>
    /* Flight Time module: compact spacing + consistent Loadmaster Pro theme */
    .container { max-width: 820px; margin: 0 auto; padding: 12px 14px; }

    /* Match other modules' Home pill (and remove iOS underline) */
    .home-button{ text-decoration:none; -webkit-tap-highlight-color: transparent; }

    .module-title{
      margin: 8px 0 12px;
      font-size: 30px;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-weight: 900;
      line-height: 1.05;
    }

    .card {
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 16px;
      padding: 12px;
      background: rgba(255,255,255,0.04);
      box-shadow: 0 10px 26px rgba(0,0,0,0.30);
    }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 640px){ .grid-2 { grid-template-columns: 1fr; } }

    label { display:block; font-weight: 800; margin-bottom: 4px; letter-spacing: .02em; }

    /* Let global theme drive colors; just tighten sizing */
    input { min-height: 44px; }
    .time-row { display: flex; gap: 10px; align-items: center; }
    .time-row input { flex: 1 1 auto; }

    .mini {
      width: auto;
      flex: 0 0 auto;
      padding: 9px 12px;
      border-radius: 12px;
      font-weight: 900;
      white-space: nowrap;
      min-height: 44px;
    }

    /* Result card (compact) */
    .result-card{
      margin-top: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(10,14,20,0.52);
      padding: 12px;
    }
    .result-top{
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
      margin-bottom: 8px;
    }
    .result-top .label{
      font-weight: 900;
      letter-spacing: .10em;
      text-transform: uppercase;
      opacity: .9;
      font-size: 12px;
    }
    .result-main{
      font-size: 40px;
      font-weight: 950;
      line-height: 1;
      margin: 0 0 6px;
    }
    .result-sub{ font-size: 13px; opacity: .92; }

    .badge { display:inline-block; padding: 2px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.18); font-size: 12px; opacity: .9; }

    .helper{
      margin-top: 8px;
      font-size: 12.5px;
      opacity: .92;
      line-height: 1.3;
    }
    .error { opacity: 1; font-weight: 900; }

    /* Actions: compact grids */
    .actions{
      margin-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.10);
      padding-top: 12px;
    }
    .action-grid{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .action-grid button{ width:100%; }
    .action-grid + .action-grid{ margin-top: 10px; }
    @media (max-width: 640px){
      .action-grid{ grid-template-columns: 1fr; }
    }

    details.conv { margin-top: 10px; }
    details.conv summary{
      cursor: pointer;
      list-style: none;
      padding: 9px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.05);
      font-weight: 900;
    }
    details.conv summary::-webkit-details-marker{ display:none; }
    details.conv .conv-body{ padding: 10px 6px 2px; }

    /* Extra-tight iPhone spacing */
    @media (max-width: 430px){
      .container{ padding: 10px 12px; }
      .module-title{ font-size: 28px; margin: 6px 0 10px; }
      .card{ padding: 10px; }
      .result-card{ padding: 10px; }
      .result-main{ font-size: 38px; }
      .helper{ margin-top: 6px; }
    }
  </style>


</head>
<body>
<div class="container">
  <h2>Flight Time</h2>

  <div class="card">
    <div class="grid">
  <div>
    <label for="startTime">Takeoff (Z)</label>
    <div class="time-row">
      <input id="startTime" type="text" inputmode="numeric" pattern="^([01]\d|2[0-3]):[0-5]\d$" placeholder="HH:MM (24h Z)" value="12:00" />
      <button class="mini" type="button" onclick="setNowZ('startTime')" aria-label="Set Takeoff to current Zulu time">Now (Z)</button>
    </div>
  </div>
  <div>
    <label for="endTime">Landing (Z)</label>
    <div class="time-row">
      <input id="endTime" type="text" inputmode="numeric" pattern="^([01]\d|2[0-3]):[0-5]\d$" placeholder="HH:MM (24h Z)" value="14:55" />
      <button class="mini" type="button" onclick="setNowZ('endTime')" aria-label="Set Landing to current Zulu time">Now (Z)</button>
    </div>
  </div>
</div>

<div id="zuluClock" class="subtle" style="margin-top:10px;"></div>


    
    <div id="result" class="result">Flight Time: 0.0</div>
    <div id="details" class="subtle"></div>
    <div id="note" class="subtle"></div>
    <div id="legs" class="subtle" style="margin-top:10px;"></div>
    <div id="rollover" class="subtle" style="margin-top:6px;font-weight:800;"></div>



    <div class="subtle"><span class="badge">Time Format</span> 24‑hour clock (HH:MM) in Zulu only.</div>

    <details class="conv">
  <summary>Minutes → Decimal Conversion (TO table)</summary>
  <div class="conv-body subtle">
    1–2=.0 • 3–8=.1 • 9–14=.2 • 15–20=.3 • 21–26=.4 • 27–33=.5 • 34–39=.6 • 40–45=.7 • 46–51=.8 • 52–57=.9 • 58–60=Next hour
  </div>
</details>

<div class="sticky-actions" role="region" aria-label="Actions">
  <div class="row primary">
  <button type="button" onclick="calc()">Calculate</button>
  <button type="button" onclick="clearAll()">Clear</button>
  <button type="button" onclick="location.href='../index.html'">Home</button>
</div>
  <div class="row" style="margin-top:10px;">
    <button type="button" onclick="addLeg()">Add Leg</button>
    <button type="button" onclick="resetLegs()">Reset Legs</button>
  </div>
</div>

  </div>
</div>

<script>
  // Conversion table from your photo
  function convertMinutes(min){
    // min: 0-60
    min = Math.max(0, Math.min(60, Math.floor(min||0)));

    if(min >= 58) return {dec: 0.0, addHour: true, band: "58–60 = Next hour"};
    if(min <= 2)  return {dec: 0.0, band: "1–2 = .0"};
    if(min <= 8)  return {dec: 0.1, band: "3–8 = .1"};
    if(min <= 14) return {dec: 0.2, band: "9–14 = .2"};
    if(min <= 20) return {dec: 0.3, band: "15–20 = .3"};
    if(min <= 26) return {dec: 0.4, band: "21–26 = .4"};
    if(min <= 33) return {dec: 0.5, band: "27–33 = .5"};
    if(min <= 39) return {dec: 0.6, band: "34–39 = .6"};
    if(min <= 45) return {dec: 0.7, band: "40–45 = .7"};
    if(min <= 51) return {dec: 0.8, band: "46–51 = .8"};
    if(min <= 57) return {dec: 0.9, band: "52–57 = .9"};
    return {dec: 0.0, band: "0 = .0"};
  }

  function parseHHMM(value){
    // value like "14:55"
    if(!value || typeof value !== "string") return null;
    const m = value.match(/^([01]\d|2[0-3]):([0-5]\d)$/);
    if(!m) return null;
    return { h: Number(m[1]), min: Number(m[2]) };
  }

  function minutesSinceMidnight(t){
    return (t.h * 60) + t.min;
  }

  function calc(){
    const s = parseHHMM(document.getElementById("startTime").value);
    const e = parseHHMM(document.getElementById("endTime").value);

    const resultEl  = document.getElementById("result");
    const detailsEl = document.getElementById("details");
    const noteEl    = document.getElementById("note");

    detailsEl.classList.remove("error");
    noteEl.classList.remove("error");

    if(!s || !e){
      resultEl.textContent = "Flight Time: —";
      detailsEl.textContent = "Enter times in HH:MM format.";
      detailsEl.classList.add("error");
      noteEl.textContent = "";
      return;
    }

    let start = minutesSinceMidnight(s);
    let end   = minutesSinceMidnight(e);

    // If landing is earlier than takeoff, assume it landed next day
    if(end < start) end += 24 * 60;

    let baseDiff = end - start; // minutes
    let diff = baseDiff + legs.reduce((a,b)=>a+b,0);
    let hours = Math.floor(diff / 60);
    let mins  = diff % 60;

    const conv = convertMinutes(mins);
    if(conv.addHour){
      hours += 1;
    }

    const total = (hours + (conv.dec || 0)).toFixed(1);
    resultEl.textContent = "Flight Time: " + total;

    const rolloverEl=document.getElementById('rollover');
    rolloverEl.textContent = end < start ? '+1 DAY (UTC rollover)' : '';

    detailsEl.textContent = `Elapsed: ${hours - (conv.addHour ? 1 : 0)}:${String(mins).padStart(2,'0')} (H:MM)`;
    if(conv.addHour){
      noteEl.textContent = "Minutes 58–60 round to next hour (+1.0).";
    } else {
      noteEl.textContent = `Minutes ${mins} → ${conv.band}`;
    }
  }


function pad2(n){ return String(n).padStart(2,'0'); }

function getNowZuluHHMM(){
  const d = new Date();
  return pad2(d.getUTCHours()) + ":" + pad2(d.getUTCMinutes());
}

function setNowZ(targetId){
  const v = getNowZuluHHMM();
  document.getElementById(targetId).value = v;
  calc();
}

function updateZuluClock(){
  const d = new Date();
  const z = pad2(d.getUTCHours()) + ":" + pad2(d.getUTCMinutes()) + ":" + pad2(d.getUTCSeconds()) + "Z";
  const el = document.getElementById("zuluClock");
  if(el) el.textContent = "Zulu: " + z;
}



// Auto-format HHMM -> HH:MM while typing
function autoFormatTime(el){
  let v = el.value.replace(/[^0-9]/g,'');
  if(v.length >= 3){
    v = v.slice(0,2) + ":" + v.slice(2,4);
  }
  el.value = v.slice(0,5);
}

["startTime","endTime"].forEach(id=>{
  const el=document.getElementById(id);
  el.addEventListener("input",()=>autoFormatTime(el));
});

let legs=[];

function diffMinutes(s,e){
  let start=s.h*60+s.min;
  let end=e.h*60+e.min;
  let rollover=false;
  if(end<start){ end+=1440; rollover=true; }
  return {mins:end-start, rollover};
}

function addLeg(){
  const s=parseHHMM(startTime.value);
  const e=parseHHMM(endTime.value);
  if(!s||!e) return;
  const d=diffMinutes(s,e);
  legs.push(d.mins);
  renderLegs();
  calc();
}

function resetLegs(){
  legs=[];
  renderLegs();
  calc();
}

function renderLegs(){
  const el=document.getElementById("legs");
  if(!legs.length){ el.textContent=""; return; }
  el.textContent="Legs (minutes): "+legs.join(" + ");
}


  function clearAll(){
    document.getElementById("startTime").value = "00:00";
    document.getElementById("endTime").value = "00:00";
    document.getElementById("result").textContent = "Flight Time: 0.0";
    document.getElementById("details").textContent = "";
    document.getElementById("note").textContent = "";
  }

  // Auto-calc on change for convenience
  ["startTime","endTime"].forEach(id => {
    document.getElementById(id).addEventListener("change", calc);
  });

  // Zulu clock
  updateZuluClock();
  setInterval(updateZuluClock, 1000);

  // Initial example calc
  calc();
</script>
</body>
</html>
