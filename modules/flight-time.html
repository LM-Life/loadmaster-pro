<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Loadmaster Pro | Flight Time</title>
  <link rel="stylesheet" href="../style.css">
  
  <style>
    /* Flight Time module: keep logic, align UI with Loadmaster Pro theme */
    .container { max-width: 820px; margin: 0 auto; padding: 16px; }

    .module-title{
      margin: 10px 0 14px;
      font-size: 34px;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-weight: 900;
    }

    .card {
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 18px;
      padding: 14px;
      background: rgba(255,255,255,0.04);
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
    }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 640px){ .grid-2 { grid-template-columns: 1fr; } }

    label { display:block; font-weight: 800; margin-bottom: 6px; letter-spacing: .02em; }

    /* Don't fight global input/button styles; just ensure comfortable sizing */
    input { min-height: 48px; }

    .time-row { display: flex; gap: 10px; align-items: center; }
    .time-row input { flex: 1 1 auto; }

    .mini {
      width: auto;
      flex: 0 0 auto;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 900;
      white-space: nowrap;
    }

    /* Result card (matches your restraint "totals boxes" vibe) */
    .result-card{
      margin-top: 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(10,14,20,0.55);
      padding: 14px;
    }
    .result-top{
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .result-top .label{
      font-weight: 900;
      letter-spacing: .08em;
      text-transform: uppercase;
      opacity: .9;
      font-size: 13px;
    }
    .result-main{
      font-size: 44px;
      font-weight: 950;
      line-height: 1;
      margin: 2px 0 6px;
    }
    .result-sub{
      font-size: 14px;
      opacity: .9;
    }

    .badge { display:inline-block; padding: 2px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.18); font-size: 12px; opacity: .9; }

    .helper{
      margin-top: 10px;
      font-size: 13px;
      opacity: .9;
      line-height: 1.35;
    }
    .error { opacity: 1; font-weight: 900; }

    /* Actions: match restraint grid layout; Home is NOT sticky */
    .actions{
      margin-top: 14px;
      border-top: 1px solid rgba(255,255,255,0.10);
      padding-top: 14px;
    }

    .action-grid{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .action-grid button{ width:100%; }
    @media (max-width: 640px){
      .action-grid{ grid-template-columns: 1fr; }
      .mini{ padding: 10px 10px; }
    }

    /* Collapsible details for reduced scroll */
    details.conv { margin-top: 12px; }
    details.conv summary{
      cursor: pointer;
      list-style: none;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.05);
      font-weight: 900;
    }
    details.conv summary::-webkit-details-marker{ display:none; }
    details.conv .conv-body{ padding: 10px 6px 2px; }
  </style>


</head>
<body>
<div class="container">
  <a class="home-button" href="../index.html">üè† Home</a>
  <h1 class="module-title">FLIGHT TIME CALCULATOR</h1>

  <div class="card">
    <div class="grid-2">
  <div>
    <label for="startTime">Takeoff (Z)</label>
    <div class="time-row">
      <input id="startTime" type="text" inputmode="numeric" pattern="^([01]\d|2[0-3]):[0-5]\d$" placeholder="HH:MM (24h Z)" value="12:00"  autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <button class="mini" type="button" onclick="setNowZ('startTime')" aria-label="Set Takeoff to current Zulu time">Now (Z)</button>
    </div>
  </div>
  <div>
    <label for="endTime">Landing (Z)</label>
    <div class="time-row">
      <input id="endTime" type="text" inputmode="numeric" pattern="^([01]\d|2[0-3]):[0-5]\d$" placeholder="HH:MM (24h Z)" value="14:55"  autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <button class="mini" type="button" onclick="setNowZ('endTime')" aria-label="Set Landing to current Zulu time">Now (Z)</button>
    </div>
  </div>
</div>

<div id="zuluClock" class="subtle" style="margin-top:10px;"></div>

    <div class="result-card" aria-live="polite">
      <div class="result-top">
        <div class="label">Flight Time</div>
        <div class="badge">Zulu ‚Ä¢ HH.MM</div>
      </div>
      <div id="resultMain" class="result-main">0.0</div>
      <div id="resultSub" class="result-sub">Elapsed: ‚Äî</div>
      <div id="note" class="helper"></div>
      <div id="rollover" class="helper" style="font-weight:900;"></div>
      <div id="legs" class="helper"></div>
    </div>


    <div class="helper"><span class="badge">Time Format</span> 24‚Äëhour clock (HH:MM) in Zulu only.</div>

    <details class="conv">
  <summary>Minutes ‚Üí Decimal Conversion (TO table)</summary>
  <div class="conv-body subtle">
    1‚Äì2=.0 ‚Ä¢ 3‚Äì8=.1 ‚Ä¢ 9‚Äì14=.2 ‚Ä¢ 15‚Äì20=.3 ‚Ä¢ 21‚Äì26=.4 ‚Ä¢ 27‚Äì33=.5 ‚Ä¢ 34‚Äì39=.6 ‚Ä¢ 40‚Äì45=.7 ‚Ä¢ 46‚Äì51=.8 ‚Ä¢ 52‚Äì57=.9 ‚Ä¢ 58‚Äì60=Next hour
  </div>
</details>


    <div class="actions" role="region" aria-label="Actions">
      <div class="action-grid">
        <button type="button" onclick="calc()">Calculate</button>
        <button type="button" onclick="clearAll()">Clear</button>
      </div>

      <div class="action-grid" style="margin-top:12px;">
        <button type="button" onclick="addLeg()">Add Leg</button>
        <button type="button" onclick="resetLegs()">Reset Legs</button>
      </div>
    </div>


  </div>
</div>
</div>

<script>
  
  // LM_NUMERIC_FOCUS_SCROLL: smooth focus scroll for numeric inputs (iPhone keyboard)
  document.addEventListener("focusin", (e) => {
    const el = e.target;
    if (!(el instanceof HTMLInputElement)) return;
    const im = (el.getAttribute("inputmode") || "").toLowerCase();
    if (im !== "numeric" && im !== "decimal") return;
    setTimeout(() => {
      try {
        el.scrollIntoView({ behavior: "smooth", block: "center", inline: "nearest" });
      } catch(_) {
        el.scrollIntoView();
      }
    }, 250);
  });

  // Conversion table from your photo
  function convertMinutes(min){
    // min: 0-60
    min = Math.max(0, Math.min(60, Math.floor(min||0)));

    if(min >= 58) return {dec: 0.0, addHour: true, band: "58‚Äì60 = Next hour"};
    if(min <= 2)  return {dec: 0.0, band: "1‚Äì2 = .0"};
    if(min <= 8)  return {dec: 0.1, band: "3‚Äì8 = .1"};
    if(min <= 14) return {dec: 0.2, band: "9‚Äì14 = .2"};
    if(min <= 20) return {dec: 0.3, band: "15‚Äì20 = .3"};
    if(min <= 26) return {dec: 0.4, band: "21‚Äì26 = .4"};
    if(min <= 33) return {dec: 0.5, band: "27‚Äì33 = .5"};
    if(min <= 39) return {dec: 0.6, band: "34‚Äì39 = .6"};
    if(min <= 45) return {dec: 0.7, band: "40‚Äì45 = .7"};
    if(min <= 51) return {dec: 0.8, band: "46‚Äì51 = .8"};
    if(min <= 57) return {dec: 0.9, band: "52‚Äì57 = .9"};
    return {dec: 0.0, band: "0 = .0"};
  }

  function parseHHMM(value){
    // value like "14:55"
    if(!value || typeof value !== "string") return null;
    const m = value.match(/^([01]\d|2[0-3]):([0-5]\d)$/);
    if(!m) return null;
    return { h: Number(m[1]), min: Number(m[2]) };
  }

  function minutesSinceMidnight(t){
    return (t.h * 60) + t.min;
  }

  function calc(){
    const s = parseHHMM(document.getElementById("startTime").value);
    const e = parseHHMM(document.getElementById("endTime").value);

    const resultEl  = document.getElementById("resultMain");    const noteEl    = document.getElementById("note");    noteEl.classList.remove("error");
    const subEl = document.getElementById("resultSub");
if(!s || !e){
      resultEl.textContent = "‚Äî";
      const subEl = document.getElementById("resultSub");
      if(subEl) subEl.textContent = "Enter times in HH:MM format.";
      noteEl.textContent = "";
      noteEl.classList.add("error");
      return;
    }

    let start = minutesSinceMidnight(s);
    let end   = minutesSinceMidnight(e);

    // If landing is earlier than takeoff, assume it landed next day
    if(end < start) end += 24 * 60;

    let baseDiff = end - start; // minutes
    let diff = baseDiff + legs.reduce((a,b)=>a+b,0);
    let hours = Math.floor(diff / 60);
    let mins  = diff % 60;

    const conv = convertMinutes(mins);
    if(conv.addHour){
      hours += 1;
    }

    const total = (hours + (conv.dec || 0)).toFixed(1);
    resultEl.textContent = total;

    const rolloverEl=document.getElementById('rollover');
    rolloverEl.textContent = end < start ? '+1 DAY (UTC rollover)' : '';

    const subEl2 = document.getElementById("resultSub");
    if(subEl2) subEl2.textContent = `Elapsed: ${hours - (conv.addHour ? 1 : 0)}:${String(mins).padStart(2,"0")} (H:MM)`;
if(conv.addHour){
      noteEl.textContent = "Minutes 58‚Äì60 round to next hour (+1.0).";
    } else {
      noteEl.textContent = `Minutes ${mins} ‚Üí ${conv.band}`;
    }
  }


function pad2(n){ return String(n).padStart(2,'0'); }

function getNowZuluHHMM(){
  const d = new Date();
  return pad2(d.getUTCHours()) + ":" + pad2(d.getUTCMinutes());
}

function setNowZ(targetId){
  const v = getNowZuluHHMM();
  document.getElementById(targetId).value = v;
  calc();
}

function updateZuluClock(){
  const d = new Date();
  const z = pad2(d.getUTCHours()) + ":" + pad2(d.getUTCMinutes()) + ":" + pad2(d.getUTCSeconds()) + "Z";
  const el = document.getElementById("zuluClock");
  if(el) el.textContent = "Current Zulu: " + z;
}



// Auto-format HHMM -> HH:MM while typing
function autoFormatTime(el){
  let v = el.value.replace(/[^0-9]/g,'');
  if(v.length >= 3){
    v = v.slice(0,2) + ":" + v.slice(2,4);
  }
  el.value = v.slice(0,5);
}

["startTime","endTime"].forEach(id=>{
  const el=document.getElementById(id);
  el.addEventListener("input",()=>autoFormatTime(el));
});

let legs=[];

function diffMinutes(s,e){
  let start=s.h*60+s.min;
  let end=e.h*60+e.min;
  let rollover=false;
  if(end<start){ end+=1440; rollover=true; }
  return {mins:end-start, rollover};
}

function addLeg(){
  const s=parseHHMM(startTime.value);
  const e=parseHHMM(endTime.value);
  if(!s||!e) return;
  const d=diffMinutes(s,e);
  legs.push(d.mins);
  renderLegs();
  calc();
}

function resetLegs(){
  legs=[];
  renderLegs();
  calc();
}

function renderLegs(){
  const el=document.getElementById("legs");
  if(!legs.length){ el.textContent=""; return; }
  el.textContent="Legs (minutes): "+legs.join(" + ");
}


  function clearAll(){
    document.getElementById("startTime").value = "00:00";
    document.getElementById("endTime").value = "00:00";
    document.getElementById("resultMain").textContent = "0.0";
    const subEl = document.getElementById("resultSub");
    if(subEl) subEl.textContent = "Elapsed: ‚Äî";    document.getElementById("note").textContent = "";
    document.getElementById("rollover").textContent = "";
    document.getElementById("legs").textContent = "";
}

  // Auto-calc on change for convenience
  ["startTime","endTime"].forEach(id => {
    document.getElementById(id).addEventListener("change", calc);
  });

  // Zulu clock
  updateZuluClock();
  setInterval(updateZuluClock, 1000);

  // Initial example calc
  calc();
</script>
</body>
</html>
