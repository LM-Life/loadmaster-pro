<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="../style.css" />
  <script>

    // ---------- State ----------
    let requiredText = "";
    let requiredRestraint = { FWD: 0, AFT: 0, LAT: 0, VERT: 0 }; // LAT = per side requirement
    let totalRestraint = { FWD: 0, AFT: 0, "LAT-LEFT": 0, "LAT-RIGHT": 0, VERT: 0 };

    // Undo stack for last-added actual restraints
    let actualHistory = [];

    let doubleMultiplier = false;

    // ---------- Helpers ----------
    function nl2br(s){ return (s || "").replace(/\n/g, "<br/>"); }

    function hasRequirementSet() {
      return (requiredRestraint.FWD + requiredRestraint.AFT + requiredRestraint.LAT + requiredRestraint.VERT) > 0;
    }

    function getRequiredForDirection(dir) {
      if (dir === "LAT-LEFT" || dir === "LAT-RIGHT") return requiredRestraint.LAT || 0; // per side
      return requiredRestraint[dir] || 0;
    }

    function remaining(req, actual) {
      return Math.max(req - actual, 0);
    }

    // Custom factor UI
    function onFactorChange() {
      const sel = document.getElementById('restraintFactor').value;
      const custom = document.getElementById('restraintFactorCustom');
      const err = document.getElementById('factorError');
      if (!custom || !err) return;
      custom.style.display = (sel === 'custom') ? 'block' : 'none';
      if (sel !== 'custom') { custom.value = ''; err.style.display = 'none'; }
    }

    function getSelectedFactor() {
      const selVal = document.getElementById('restraintFactor').value;
      if (selVal !== 'custom') return parseFloat(selVal);

      const err = document.getElementById('factorError');
      const raw = (document.getElementById('restraintFactorCustom').value || "").replace(/,/g,'');
      const v = parseFloat(raw);

      if (!Number.isFinite(v) || v <= 0) {
        err.textContent = 'Enter a valid custom factor (lbs).';
        err.style.display = 'block';
        return null;
      }
      err.style.display = 'none';
      return v;
    }

    function toggleMultiplier() {
      doubleMultiplier = !doubleMultiplier;
    
      const btn = document.getElementById("multiplierBtn");
      btn.textContent = doubleMultiplier ? "√ó2 ON" : "√ó2 OFF";
    
      btn.classList.toggle("on", doubleMultiplier);
      btn.classList.toggle("off", !doubleMultiplier);
    }

    // Build display (tight ‚Äúcolumn‚Äù totals)
    function buildDisplay(extraMessageHtml = "") {
      

      const statusItems = [
        { key: "FWD",       label: "FWD" },
        { key: "AFT",       label: "AFT" },
        { key: "LAT-LEFT",  label: "LAT-L" },
        { key: "LAT-RIGHT", label: "LAT-R" },
        { key: "VERT",      label: "VERT" }
      ];

      let statusGridHtml = "";
      if (hasRequirementSet()) {
        statusGridHtml = '<div class="status-grid">' + statusItems.map(it => {
          const act = Number(totalRestraint[it.key] || 0);
          const req = Number(getRequiredForDirection(it.key) || 0);
          const ok  = act >= req;
          const rem = remaining(req, act);
          return (
            '<div class="status-card ' + (ok ? 'pass' : 'fail') + '">' +
              '<div class="status-top">' + it.label + ' <span class="status-emoji">' + (ok ? '‚úÖ' : '‚ùå') + '</span></div>' +
              '<div class="status-mid">ACT ' + act.toLocaleString() + '</div>' +'<div class="status-bot">REM ' + rem.toLocaleString() + '</div>' +
            '</div>'
          );
        }).join('') + '</div>';
      }

const reqSet = hasRequirementSet();

      const rows = [
        { key: "FWD",       label: "FWD" },
        { key: "AFT",       label: "AFT" },
        { key: "LAT-LEFT",  label: "LAT-LEFT" },
        { key: "LAT-RIGHT", label: "LAT-RIGHT" },
        { key: "VERT",      label: "VERT" }
      ];

      let html = "";

      if (reqSet) {
        html += statusGridHtml;
      } else {
        html += `<div class="result-block" style="opacity:.9;">Enter cargo weight and tap <b>Calculate Required Restraint</b> to populate totals.</div>`;
      }

      if (extraMessageHtml) {
        html += `<div style="margin-top:.5rem; color:#f66;">${extraMessageHtml}</div>`;
      }

      return html;
    }

    // ---------- Calculations ----------
    function calculateRestraint() {
      const weight = parseFloat(document.getElementById("cargoWeight").value);
      if (!Number.isFinite(weight) || weight <= 0) {
        document.getElementById("result").innerHTML = "Enter a valid cargo weight.";
        return;
      }

      const g = { FWD: 3.0, AFT: 1.5, LAT: 1.5, VERT: 2.0 };

      requiredRestraint = {
        FWD: Math.round(weight * g.FWD),
        AFT: Math.round(weight * g.AFT),
        LAT: Math.round(weight * g.LAT), // per side
        VERT: Math.round(weight * g.VERT)
      };

      requiredText =
`Required Restraint for ${Math.round(weight)} lbs:
FWD:  ${requiredRestraint.FWD} lbs
AFT:  ${requiredRestraint.AFT} lbs
LAT:  ${requiredRestraint.LAT} lbs (each side)
VERT: ${requiredRestraint.VERT} lbs`;

      document.getElementById("result").innerHTML = buildDisplay();
    }

    function calculateActualRestraint() {
      const actual = parseFloat(document.getElementById("actualLength").value);
      const effective = parseFloat(document.getElementById("effectiveLength").value);
      const direction = document.getElementById("restraintDirection").value;

      if (!Number.isFinite(actual) || actual <= 0 || !Number.isFinite(effective) || effective <= 0) {
        document.getElementById("result").innerHTML = buildDisplay("Enter valid actual and effective lengths.");
        return;
      }

      const factor = getSelectedFactor();
      if (factor === null) return; // invalid custom factor

      let value = (effective / actual) * factor;
      if (doubleMultiplier) value *= 2;
      value = Math.round(value);

      if (!(direction in totalRestraint)) {
        document.getElementById("result").innerHTML = buildDisplay("Invalid direction selection.");
        return;
      }

      actualHistory.push({ direction, value });
      const undoBtn = document.getElementById("undoBtn");
      if (undoBtn) undoBtn.disabled = actualHistory.length === 0;

      totalRestraint[direction] += value;
      document.getElementById("result").innerHTML = buildDisplay();
    }

    function clearAll() {
      // Clear inputs
      document.getElementById("cargoWeight").value = "";
      document.getElementById("actualLength").value = "";
      document.getElementById("effectiveLength").value = "";
    
      // Reset dropdowns
      document.getElementById("restraintDirection").value = "FWD";
      document.getElementById("restraintFactor").value = "25000"; // match your default option
      document.getElementById("restraintFactorCustom").value = "";
      document.getElementById("restraintFactorCustom").style.display = "none";
      document.getElementById("factorError").style.display = "none";
    
      // Reset state
      totalRestraint = { FWD: 0, AFT: 0, "LAT-LEFT": 0, "LAT-RIGHT": 0, VERT: 0 };
      requiredRestraint = { FWD: 0, AFT: 0, LAT: 0, VERT: 0 };
      requiredText = "";
    

      actualHistory = [];
      const undoBtn = document.getElementById("undoBtn");
      if (undoBtn) undoBtn.disabled = true;

      // Reset 2x toggle (supports BOTH old + new IDs/classes)
      doubleMultiplier = false;
      const tgl =
        document.getElementById("multiplierBtn") ||
        document.getElementById("multiplierToggle");
    
      if (tgl) {
        tgl.textContent = "√ó2 OFF";
        tgl.classList.remove("on", "active");
        tgl.classList.add("off");
      }
    
      // Clear results
      document.getElementById("result").innerHTML = "";
    }
    function undoLast() {
      if (!actualHistory || actualHistory.length === 0) return;

      const last = actualHistory.pop();
      if (last && (last.direction in totalRestraint)) {
        totalRestraint[last.direction] = Math.max(0, (totalRestraint[last.direction] || 0) - (last.value || 0));
      }

      const undoBtn = document.getElementById("undoBtn");
      if (undoBtn) undoBtn.disabled = actualHistory.length === 0;

      document.getElementById("result").innerHTML = buildDisplay();
    }


    // ---------- Init ----------
    document.getElementById('restraintFactor').addEventListener('change', onFactorChange);
    onFactorChange();
  
</script>
<style>
    /* Restraint results: compact status grid */
    .status-grid{
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin: 12px 0 10px;
    }
    .status-card{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      border-radius: 14px;
      padding: 10px 10px;
      text-align: center;
    }
    .status-card.pass{ border-color: rgba(80, 220, 140, .45); }
    .status-card.fail{ border-color: rgba(255, 90, 90, .55); }
    .status-top{
      font-weight: 900;
      letter-spacing: .04em;
      opacity: .95;
      font-size: 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      white-space: nowrap;
    }
    .status-mid{
      margin-top: 6px;
      font-weight: 800;
      font-size: 12px;
      opacity: .9;
      white-space: nowrap;
    }
    .status-bot{

      margin-top: 4px;
      font-weight: 900;
      font-size: 14px;
      white-space: nowrap;
    }
    @media (max-width: 420px){
      .status-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
      .status-mid{
      margin-top: 6px;
      font-weight: 800;
      font-size: 12px;
      opacity: .9;
      white-space: nowrap;
    }
    .status-bot{
     font-size: 13px; }
    }
  </style>
  <style>
    /* LM_RESTRAINT_ACTION_GRID: paired action buttons */
    .actual-actions .action-grid{ gap: 12px; margin-top: 12px; }
    .actual-actions .action-grid button{ width:100%; }
  </style>

  <style>
    /* LM_RESTRAINT_ACTION_GRID_MOBILEFIX: force Undo/Clear and x2/Add to remain 2-column on mobile */
    @media (max-width: 768px) {
      .actual-actions .action-grid {
        display: grid !important;
        grid-template-columns: 1fr 1fr !important;
        gap: 12px !important;
      }
      .actual-actions .action-grid button {
        width: 100% !important;
      }
    }
  </style>

</head>
<body>
  
    <a class="home-button" href="../index.html">üè† Home</a>
<h1>Restraint Calculator</h1>

  <!-- Required Restraint -->
  <label for="cargoWeight">Cargo Weight (lbs):</label>
  <input id="cargoWeight" class="form-control" inputmode="numeric" pattern="[0-9]*" placeholder="e.g., 12000" />

  <button onclick="calculateRestraint()">Calculate Required Restraint</button>
  <div id="result" class="card mt-2"></div>

  <hr class="divider" />

<!-- Actual Restraint -->
<h2>Actual Restraint Calculator</h2>

<div class="grid-2">
  <div>
    <label for="actualLength">Actual Length (in):</label>
    <input id="actualLength" class="form-control" inputmode="numeric" pattern="[0-9]*" placeholder="e.g., 100" />
  </div>

  <div>
    <label for="effectiveLength">Effective Length (in):</label>
    <input id="effectiveLength" class="form-control" inputmode="numeric" pattern="[0-9]*" placeholder="e.g., 80" />
  </div>
</div>

<div class="grid-2">
  <div>
    <label for="restraintDirection">Direction:</label>
    <select id="restraintDirection" class="form-control">
      <option value="FWD">FWD</option>
      <option value="AFT">AFT</option>
      <option value="LAT-LEFT">LAT ‚Äì LEFT</option>
      <option value="LAT-RIGHT">LAT ‚Äì RIGHT</option>
      <option value="VERT">VERT</option>
    </select>
  </div>

  <div>
    <label for="restraintFactor">Restraint Factor:</label>
    <select id="restraintFactor" class="form-control">
      <option value="5000">5,000 lbs</option>
      <option value="7500">7,500 lbs</option>
      <option value="10000">10,000 lbs</option>
      <option value="25000" selected>25,000 lbs</option>
      <option value="custom">Custom‚Ä¶</option>
    </select>
  </div>
</div>

<!-- Hidden until "Custom‚Ä¶" is selected -->
<input
  type="text"
  inputmode="numeric"
  pattern="[0-9]*"
  id="restraintFactorCustom"
  class="form-control"
  placeholder="Enter custom factor in lbs (e.g., 8000)"
  style="display:none; margin-top:.5rem;"
/>
<div id="factorError" style="color:#f66; font-size:.95rem; display:none;"></div>

<div class="actual-actions">
  <div class="grid-2 action-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
    <button id="multiplierBtn" class="btn btn-multiplier off" onclick="toggleMultiplier()">√ó2 OFF</button>
    <button onclick="calculateActualRestraint()">Add Restraint</button>
  </div>
  <div class="grid-2 action-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
    <button id="undoBtn" class="btn-secondary" onclick="undoLast()" disabled>Undo</button>
    <button class="btn-danger" onclick="clearAll()">Clear All</button>
  </div>
</div>

  <script>

    // ---------- State ----------
    let requiredText = "";
    let requiredRestraint = { FWD: 0, AFT: 0, LAT: 0, VERT: 0 }; // LAT = per side requirement
    let totalRestraint = { FWD: 0, AFT: 0, "LAT-LEFT": 0, "LAT-RIGHT": 0, VERT: 0 };
    let doubleMultiplier = false;

    // ---------- Helpers ----------
    function nl2br(s){ return (s || "").replace(/\n/g, "<br/>"); }

    function hasRequirementSet() {
      return (requiredRestraint.FWD + requiredRestraint.AFT + requiredRestraint.LAT + requiredRestraint.VERT) > 0;
    }

    function getRequiredForDirection(dir) {
      if (dir === "LAT-LEFT" || dir === "LAT-RIGHT") return requiredRestraint.LAT || 0; // per side
      return requiredRestraint[dir] || 0;
    }

    function remaining(req, actual) {
      return Math.max(req - actual, 0);
    }

    // Custom factor UI
    function onFactorChange() {
      const sel = document.getElementById('restraintFactor').value;
      const custom = document.getElementById('restraintFactorCustom');
      const err = document.getElementById('factorError');
      if (!custom || !err) return;
      custom.style.display = (sel === 'custom') ? 'block' : 'none';
      if (sel !== 'custom') { custom.value = ''; err.style.display = 'none'; }
    }

    function getSelectedFactor() {
      const selVal = document.getElementById('restraintFactor').value;
      if (selVal !== 'custom') return parseFloat(selVal);

      const err = document.getElementById('factorError');
      const raw = (document.getElementById('restraintFactorCustom').value || "").replace(/,/g,'');
      const v = parseFloat(raw);

      if (!Number.isFinite(v) || v <= 0) {
        err.textContent = 'Enter a valid custom factor (lbs).';
        err.style.display = 'block';
        return null;
      }
      err.style.display = 'none';
      return v;
    }

    function toggleMultiplier() {
      doubleMultiplier = !doubleMultiplier;
    
      const btn = document.getElementById("multiplierBtn");
      btn.textContent = doubleMultiplier ? "√ó2 ON" : "√ó2 OFF";
    
      btn.classList.toggle("on", doubleMultiplier);
      btn.classList.toggle("off", !doubleMultiplier);
    }

    // Build display (tight ‚Äúcolumn‚Äù totals)
    function buildDisplay(extraMessageHtml = "") {
      

      const statusItems = [
        { key: "FWD",       label: "FWD" },
        { key: "AFT",       label: "AFT" },
        { key: "LAT-LEFT",  label: "LAT-L" },
        { key: "LAT-RIGHT", label: "LAT-R" },
        { key: "VERT",      label: "VERT" }
      ];

      let statusGridHtml = "";
      if (hasRequirementSet()) {
        statusGridHtml = '<div class="status-grid">' + statusItems.map(it => {
          const act = Number(totalRestraint[it.key] || 0);
          const req = Number(getRequiredForDirection(it.key) || 0);
          const ok  = act >= req;
          const rem = remaining(req, act);
          return (
            '<div class="status-card ' + (ok ? 'pass' : 'fail') + '">' +
              '<div class="status-top">' + it.label + ' <span class="status-emoji">' + (ok ? '‚úÖ' : '‚ùå') + '</span></div>' +
              '<div class="status-mid">ACT ' + act.toLocaleString() + '</div>' +'<div class="status-bot">REM ' + rem.toLocaleString() + '</div>' +
            '</div>'
          );
        }).join('') + '</div>';
      }

const reqSet = hasRequirementSet();

      const rows = [
        { key: "FWD",       label: "FWD" },
        { key: "AFT",       label: "AFT" },
        { key: "LAT-LEFT",  label: "LAT-LEFT" },
        { key: "LAT-RIGHT", label: "LAT-RIGHT" },
        { key: "VERT",      label: "VERT" }
      ];

      let html = "";

      if (reqSet) {
        html += statusGridHtml;
      } else {
        html += `<div class="result-block" style="opacity:.9;">Enter cargo weight and tap <b>Calculate Required Restraint</b> to populate totals.</div>`;
      }

      if (extraMessageHtml) {
        html += `<div style="margin-top:.5rem; color:#f66;">${extraMessageHtml}</div>`;
      }

      return html;
    }

    // ---------- Calculations ----------
    function calculateRestraint() {
      const weight = parseFloat(document.getElementById("cargoWeight").value);
      if (!Number.isFinite(weight) || weight <= 0) {
        document.getElementById("result").innerHTML = "Enter a valid cargo weight.";
        return;
      }

      const g = { FWD: 3.0, AFT: 1.5, LAT: 1.5, VERT: 2.0 };

      requiredRestraint = {
        FWD: Math.round(weight * g.FWD),
        AFT: Math.round(weight * g.AFT),
        LAT: Math.round(weight * g.LAT), // per side
        VERT: Math.round(weight * g.VERT)
      };

      requiredText =
`Required Restraint for ${Math.round(weight)} lbs:
FWD:  ${requiredRestraint.FWD} lbs
AFT:  ${requiredRestraint.AFT} lbs
LAT:  ${requiredRestraint.LAT} lbs (each side)
VERT: ${requiredRestraint.VERT} lbs`;

      document.getElementById("result").innerHTML = buildDisplay();
    }

    function calculateActualRestraint() {
      const actual = parseFloat(document.getElementById("actualLength").value);
      const effective = parseFloat(document.getElementById("effectiveLength").value);
      const direction = document.getElementById("restraintDirection").value;

      if (!Number.isFinite(actual) || actual <= 0 || !Number.isFinite(effective) || effective <= 0) {
        document.getElementById("result").innerHTML = buildDisplay("Enter valid actual and effective lengths.");
        return;
      }

      const factor = getSelectedFactor();
      if (factor === null) return; // invalid custom factor

      let value = (effective / actual) * factor;
      if (doubleMultiplier) value *= 2;
      value = Math.round(value);

      if (!(direction in totalRestraint)) {
        document.getElementById("result").innerHTML = buildDisplay("Invalid direction selection.");
        return;
      }

      totalRestraint[direction] += value;
      document.getElementById("result").innerHTML = buildDisplay();
    }

    function clearAll() {
      // Clear inputs
      document.getElementById("cargoWeight").value = "";
      document.getElementById("actualLength").value = "";
      document.getElementById("effectiveLength").value = "";
    
      // Reset dropdowns
      document.getElementById("restraintDirection").value = "FWD";
      document.getElementById("restraintFactor").value = "25000"; // match your default option
      document.getElementById("restraintFactorCustom").value = "";
      document.getElementById("restraintFactorCustom").style.display = "none";
      document.getElementById("factorError").style.display = "none";
    
      // Reset state
      totalRestraint = { FWD: 0, AFT: 0, "LAT-LEFT": 0, "LAT-RIGHT": 0, VERT: 0 };
      requiredRestraint = { FWD: 0, AFT: 0, LAT: 0, VERT: 0 };
      requiredText = "";
    
      // Reset 2x toggle (supports BOTH old + new IDs/classes)
      doubleMultiplier = false;
      const tgl =
        document.getElementById("multiplierBtn") ||
        document.getElementById("multiplierToggle");
    
      if (tgl) {
        tgl.textContent = "√ó2 OFF";
        tgl.classList.remove("on", "active");
        tgl.classList.add("off");
      }
    
      // Clear results
      document.getElementById("result").innerHTML = "";
    }

    // ---------- Init ----------
    document.getElementById('restraintFactor').addEventListener('change', onFactorChange);
    onFactorChange();
  
</script>
</body>
</html>
